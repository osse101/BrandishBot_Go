go: downloading github.com/joho/godotenv v1.5.1
go: downloading github.com/swaggo/swag v1.16.6
go: downloading github.com/stretchr/testify v1.11.1
go: downloading github.com/jackc/pgx/v5 v5.7.6
go: downloading github.com/bwmarrin/discordgo v0.29.0
go: downloading github.com/google/uuid v1.6.0
go: downloading github.com/testcontainers/testcontainers-go v0.40.0
go: downloading github.com/testcontainers/testcontainers-go/modules/postgres v0.40.0
go: downloading github.com/go-playground/validator/v10 v10.28.0
go: downloading github.com/prometheus/client_golang v1.23.2
go: downloading github.com/swaggo/http-swagger v1.3.4
go: downloading github.com/davecgh/go-spew v1.1.1
go: downloading github.com/pmezard/go-difflib v1.0.0
go: downloading github.com/KyleBanks/depth v1.2.1
go: downloading github.com/go-openapi/spec v0.22.1
go: downloading golang.org/x/tools v0.39.0
go: downloading github.com/jackc/puddle/v2 v2.2.2
go: downloading github.com/gorilla/websocket v1.4.2
go: downloading golang.org/x/crypto v0.44.0
go: downloading github.com/stretchr/objx v0.5.2
go: downloading github.com/gabriel-vasile/mimetype v1.4.10
go: downloading github.com/go-playground/universal-translator v0.18.1
go: downloading github.com/leodido/go-urn v1.4.0
go: downloading golang.org/x/text v0.31.0
go: downloading github.com/beorn7/perks v1.0.1
go: downloading github.com/cespare/xxhash/v2 v2.3.0
go: downloading github.com/prometheus/client_model v0.6.2
go: downloading github.com/prometheus/common v0.66.1
go: downloading github.com/prometheus/procfs v0.16.1
go: downloading google.golang.org/protobuf v1.36.10
go: downloading github.com/containerd/errdefs v1.0.0
go: downloading github.com/docker/docker v28.5.1+incompatible
go: downloading github.com/docker/go-connections v0.6.0
go: downloading dario.cat/mergo v1.0.2
go: downloading github.com/cenkalti/backoff/v4 v4.3.0
go: downloading github.com/containerd/platforms v0.2.1
go: downloading github.com/cpuguy83/dockercfg v0.3.2
go: downloading github.com/moby/go-archive v0.1.0
go: downloading github.com/moby/patternmatcher v0.6.0
go: downloading github.com/opencontainers/image-spec v1.1.1
go: downloading github.com/moby/term v0.5.0
go: downloading github.com/swaggo/files v1.0.1
go: downloading gopkg.in/yaml.v3 v3.0.1
go: downloading github.com/jackc/pgpassfile v1.0.0
go: downloading github.com/jackc/pgservicefile v0.0.0-20240606120523-5a60cdf6a761
go: downloading github.com/go-openapi/jsonpointer v0.22.3
go: downloading github.com/go-openapi/jsonreference v0.21.3
go: downloading github.com/go-openapi/swag/jsonname v0.25.3
go: downloading github.com/go-openapi/swag/jsonutils v0.25.3
go: downloading github.com/go-openapi/swag/loading v0.25.3
go: downloading github.com/go-openapi/swag/stringutils v0.25.3
go: downloading golang.org/x/sync v0.18.0
go: downloading github.com/go-playground/locales v0.14.1
go: downloading golang.org/x/sys v0.38.0
go: downloading github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822
go: downloading go.yaml.in/yaml/v2 v2.4.2
go: downloading github.com/containerd/log v0.1.0
go: downloading github.com/moby/docker-image-spec v1.3.1
go: downloading github.com/opencontainers/go-digest v1.0.0
go: downloading github.com/docker/go-units v0.5.0
go: downloading github.com/morikuni/aec v1.0.0
go: downloading github.com/containerd/errdefs/pkg v0.3.0
go: downloading github.com/distribution/reference v0.6.0
go: downloading github.com/pkg/errors v0.9.1
go: downloading go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.49.0
go: downloading go.opentelemetry.io/otel/trace v1.37.0
go: downloading github.com/magiconair/properties v1.8.10
go: downloading github.com/shirou/gopsutil/v4 v4.25.6
go: downloading go.opentelemetry.io/otel v1.37.0
go: downloading github.com/moby/sys/sequential v0.6.0
go: downloading github.com/moby/sys/user v0.4.0
go: downloading github.com/moby/sys/userns v0.1.0
go: downloading github.com/go-openapi/swag/yamlutils v0.25.3
go: downloading github.com/go-openapi/swag/typeutils v0.25.3
go: downloading golang.org/x/mod v0.30.0
go: downloading golang.org/x/net v0.47.0
go: downloading github.com/sirupsen/logrus v1.9.3
go: downloading github.com/felixge/httpsnoop v1.0.4
go: downloading go.opentelemetry.io/otel/metric v1.37.0
go: downloading github.com/klauspost/compress v1.18.0
go: downloading github.com/tklauser/go-sysconf v0.3.12
go: downloading github.com/go-openapi/swag/conv v0.25.3
go: downloading go.yaml.in/yaml/v3 v3.0.4
go: downloading github.com/go-logr/logr v1.4.3
go: downloading github.com/tklauser/numcpus v0.6.1
go: downloading github.com/go-logr/stdr v1.2.2
go: downloading go.opentelemetry.io/auto/sdk v1.1.0
?   	github.com/osse101/BrandishBot_Go/cmd/app	[no test files]
?   	github.com/osse101/BrandishBot_Go/cmd/debug	[no test files]
?   	github.com/osse101/BrandishBot_Go/cmd/discord	[no test files]
?   	github.com/osse101/BrandishBot_Go/cmd/reset	[no test files]
?   	github.com/osse101/BrandishBot_Go/cmd/setup	[no test files]
?   	github.com/osse101/BrandishBot_Go/docs/swagger	[no test files]
# github.com/osse101/BrandishBot_Go/internal/crafting [github.com/osse101/BrandishBot_Go/internal/crafting.test]
internal/crafting/service_test.go:214:26: undefined: lockManager
internal/crafting/service_test.go:263:26: undefined: lockManager
internal/crafting/service_test.go:291:26: undefined: lockManager
internal/crafting/service_test.go:307:26: undefined: lockManager
internal/crafting/service_test.go:324:26: undefined: lockManager
internal/crafting/service_test.go:337:26: undefined: lockManager
internal/crafting/service_test.go:366:26: undefined: lockManager
internal/crafting/service_test.go:413:26: undefined: lockManager
internal/crafting/service_test.go:437:26: undefined: lockManager
internal/crafting/service_test.go:453:26: undefined: lockManager
internal/crafting/service_test.go:453:26: too many errors
=== RUN   TestGetEnvAsInt
=== RUN   TestGetEnvAsInt/returns_default_value_when_env_var_not_set
=== RUN   TestGetEnvAsInt/parses_valid_integer_from_env_var
=== RUN   TestGetEnvAsInt/returns_default_for_invalid_integer
=== RUN   TestGetEnvAsInt/parses_negative_integers
=== RUN   TestGetEnvAsInt/parses_zero
=== RUN   TestGetEnvAsInt/returns_default_for_float_values
=== RUN   TestGetEnvAsInt/returns_default_for_empty_string
--- PASS: TestGetEnvAsInt (0.00s)
    --- PASS: TestGetEnvAsInt/returns_default_value_when_env_var_not_set (0.00s)
    --- PASS: TestGetEnvAsInt/parses_valid_integer_from_env_var (0.00s)
    --- PASS: TestGetEnvAsInt/returns_default_for_invalid_integer (0.00s)
    --- PASS: TestGetEnvAsInt/parses_negative_integers (0.00s)
    --- PASS: TestGetEnvAsInt/parses_zero (0.00s)
    --- PASS: TestGetEnvAsInt/returns_default_for_float_values (0.00s)
    --- PASS: TestGetEnvAsInt/returns_default_for_empty_string (0.00s)
=== RUN   TestGetEnvAsDuration
=== RUN   TestGetEnvAsDuration/returns_default_value_when_env_var_not_set
=== RUN   TestGetEnvAsDuration/parses_valid_duration_from_env_var
=== RUN   TestGetEnvAsDuration/parses_seconds
=== RUN   TestGetEnvAsDuration/parses_hours
=== RUN   TestGetEnvAsDuration/parses_complex_duration
=== RUN   TestGetEnvAsDuration/returns_default_for_invalid_duration
=== RUN   TestGetEnvAsDuration/returns_default_for_plain_numbers_without_unit
=== RUN   TestGetEnvAsDuration/returns_default_for_empty_string
=== RUN   TestGetEnvAsDuration/parses_nanoseconds
=== RUN   TestGetEnvAsDuration/parses_microseconds
=== RUN   TestGetEnvAsDuration/parses_milliseconds
--- PASS: TestGetEnvAsDuration (0.00s)
    --- PASS: TestGetEnvAsDuration/returns_default_value_when_env_var_not_set (0.00s)
    --- PASS: TestGetEnvAsDuration/parses_valid_duration_from_env_var (0.00s)
    --- PASS: TestGetEnvAsDuration/parses_seconds (0.00s)
    --- PASS: TestGetEnvAsDuration/parses_hours (0.00s)
    --- PASS: TestGetEnvAsDuration/parses_complex_duration (0.00s)
    --- PASS: TestGetEnvAsDuration/returns_default_for_invalid_duration (0.00s)
    --- PASS: TestGetEnvAsDuration/returns_default_for_plain_numbers_without_unit (0.00s)
    --- PASS: TestGetEnvAsDuration/returns_default_for_empty_string (0.00s)
    --- PASS: TestGetEnvAsDuration/parses_nanoseconds (0.00s)
    --- PASS: TestGetEnvAsDuration/parses_microseconds (0.00s)
    --- PASS: TestGetEnvAsDuration/parses_milliseconds (0.00s)
=== RUN   TestLoad_DatabasePoolConfig
=== RUN   TestLoad_DatabasePoolConfig/loads_default_database_pool_configuration
=== RUN   TestLoad_DatabasePoolConfig/loads_custom_database_pool_configuration
=== RUN   TestLoad_DatabasePoolConfig/uses_defaults_for_invalid_pool_config_values
=== RUN   TestLoad_DatabasePoolConfig/production-like_pool_configuration
--- PASS: TestLoad_DatabasePoolConfig (0.00s)
    --- PASS: TestLoad_DatabasePoolConfig/loads_default_database_pool_configuration (0.00s)
    --- PASS: TestLoad_DatabasePoolConfig/loads_custom_database_pool_configuration (0.00s)
    --- PASS: TestLoad_DatabasePoolConfig/uses_defaults_for_invalid_pool_config_values (0.00s)
    --- PASS: TestLoad_DatabasePoolConfig/production-like_pool_configuration (0.00s)
=== RUN   TestLoad
=== RUN   TestLoad/loads_config_with_defaults_when_no_env_vars_set
=== RUN   TestLoad/loads_config_from_environment_variables
=== RUN   TestLoad/returns_error_when_API_KEY_is_missing
=== RUN   TestLoad/returns_error_for_invalid_PORT
=== RUN   TestLoad/handles_negative_port_number
=== RUN   TestLoad/handles_PORT_edge_cases
=== RUN   TestLoad/handles_PORT_edge_cases/zero_port
=== RUN   TestLoad/handles_PORT_edge_cases/max_valid_port
=== RUN   TestLoad/handles_PORT_edge_cases/above_max_port
=== RUN   TestLoad/handles_PORT_edge_cases/float_port
=== RUN   TestLoad/handles_PORT_edge_cases/empty_string
--- PASS: TestLoad (0.00s)
    --- PASS: TestLoad/loads_config_with_defaults_when_no_env_vars_set (0.00s)
    --- PASS: TestLoad/loads_config_from_environment_variables (0.00s)
    --- PASS: TestLoad/returns_error_when_API_KEY_is_missing (0.00s)
    --- PASS: TestLoad/returns_error_for_invalid_PORT (0.00s)
    --- PASS: TestLoad/handles_negative_port_number (0.00s)
    --- PASS: TestLoad/handles_PORT_edge_cases (0.00s)
        --- PASS: TestLoad/handles_PORT_edge_cases/zero_port (0.00s)
        --- PASS: TestLoad/handles_PORT_edge_cases/max_valid_port (0.00s)
        --- PASS: TestLoad/handles_PORT_edge_cases/above_max_port (0.00s)
        --- PASS: TestLoad/handles_PORT_edge_cases/float_port (0.00s)
        --- PASS: TestLoad/handles_PORT_edge_cases/empty_string (0.00s)
=== RUN   TestGetDBConnString
=== RUN   TestGetDBConnString/generates_correct_connection_string
=== RUN   TestGetDBConnString/handles_special_characters_in_password
=== RUN   TestGetDBConnString/uses_custom_port
=== RUN   TestGetDBConnString/includes_sslmode=disable
--- PASS: TestGetDBConnString (0.00s)
    --- PASS: TestGetDBConnString/generates_correct_connection_string (0.00s)
    --- PASS: TestGetDBConnString/handles_special_characters_in_password (0.00s)
    --- PASS: TestGetDBConnString/uses_custom_port (0.00s)
    --- PASS: TestGetDBConnString/includes_sslmode=disable (0.00s)
=== RUN   TestConfig_RealWorldScenarios
=== RUN   TestConfig_RealWorldScenarios/typical_development_environment
=== RUN   TestConfig_RealWorldScenarios/typical_production_environment
=== RUN   TestConfig_RealWorldScenarios/docker_compose_environment
--- PASS: TestConfig_RealWorldScenarios (0.00s)
    --- PASS: TestConfig_RealWorldScenarios/typical_development_environment (0.00s)
    --- PASS: TestConfig_RealWorldScenarios/typical_production_environment (0.00s)
    --- PASS: TestConfig_RealWorldScenarios/docker_compose_environment (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/config	0.011s
FAIL	github.com/osse101/BrandishBot_Go/internal/crafting [build failed]
=== RUN   TestPool_ConnectionsReleased
    pool_test.go:23:
		Error Trace:	/app/internal/database/pool_test.go:23
		Error:      	Received unexpected error:
				failed to ping database: failed to connect to `user=postgres database=brandishbot`:
					127.0.0.1:5432 (localhost): dial error: dial tcp 127.0.0.1:5432: connect: connection refused
					[::1]:5432 (localhost): dial error: dial tcp [::1]:5432: connect: connection refused
		Test:       	TestPool_ConnectionsReleased
--- FAIL: TestPool_ConnectionsReleased (0.01s)
=== RUN   TestPool_MaxConnsEnforced
    pool_test.go:56:
		Error Trace:	/app/internal/database/pool_test.go:56
		Error:      	Received unexpected error:
				failed to ping database: failed to connect to `user=postgres database=brandishbot`:
					127.0.0.1:5432 (localhost): dial error: dial tcp 127.0.0.1:5432: connect: connection refused
					[::1]:5432 (localhost): dial error: dial tcp [::1]:5432: connect: connection refused
		Test:       	TestPool_MaxConnsEnforced
--- FAIL: TestPool_MaxConnsEnforced (0.00s)
=== RUN   TestPool_NoConnectionLeakOnError
    pool_test.go:113:
		Error Trace:	/app/internal/database/pool_test.go:113
		Error:      	Received unexpected error:
				failed to ping database: failed to connect to `user=postgres database=brandishbot`:
					127.0.0.1:5432 (localhost): dial error: dial tcp 127.0.0.1:5432: connect: connection refused
					[::1]:5432 (localhost): dial error: dial tcp [::1]:5432: connect: connection refused
		Test:       	TestPool_NoConnectionLeakOnError
--- FAIL: TestPool_NoConnectionLeakOnError (0.00s)
=== RUN   TestPool_ConcurrentAccess
    pool_test.go:145:
		Error Trace:	/app/internal/database/pool_test.go:145
		Error:      	Received unexpected error:
				failed to ping database: failed to connect to `user=postgres database=brandishbot`:
					127.0.0.1:5432 (localhost): dial error: dial tcp 127.0.0.1:5432: connect: connection refused
					[::1]:5432 (localhost): dial error: dial tcp [::1]:5432: connect: connection refused
		Test:       	TestPool_ConcurrentAccess
--- FAIL: TestPool_ConcurrentAccess (0.00s)
FAIL
FAIL	github.com/osse101/BrandishBot_Go/internal/database	0.037s
# github.com/osse101/BrandishBot_Go/internal/database/postgres [github.com/osse101/BrandishBot_Go/internal/database/postgres.test]
internal/database/postgres/progression_integration_test.go:154:14: repo.StartVoting undefined (type progression.Repository has no field or method StartVoting)
internal/database/postgres/progression_integration_test.go:160:23: repo.GetActiveVoting undefined (type progression.Repository has no field or method GetActiveVoting)
internal/database/postgres/progression_integration_test.go:170:14: repo.RecordUserVote undefined (type progression.Repository has no field or method RecordUserVote)
internal/database/postgres/progression_integration_test.go:176:25: repo.HasUserVoted undefined (type progression.Repository has no field or method HasUserVoted)
internal/database/postgres/progression_integration_test.go:182:14: repo.IncrementVote undefined (type progression.Repository has no field or method IncrementVote)
internal/database/postgres/progression_integration_test.go:188:14: repo.EndVoting undefined (type progression.Repository has no field or method EndVoting)
internal/database/postgres/progression_leaderboard_test.go:17:10: undefined: setupTestDB
internal/database/postgres/progression_leaderboard_test.go:18:8: undefined: cleanupTestDB
internal/database/postgres/progression_leaderboard_test.go:89:10: undefined: setupTestDB
internal/database/postgres/progression_leaderboard_test.go:90:8: undefined: cleanupTestDB
internal/database/postgres/progression_leaderboard_test.go:90:8: too many errors
FAIL	github.com/osse101/BrandishBot_Go/internal/database/postgres [build failed]
# github.com/osse101/BrandishBot_Go/internal/handler [github.com/osse101/BrandishBot_Go/internal/handler.test]
internal/handler/disassemble_test.go:285:51: cannot use mockProgression (variable of type *MockProgressionService) as progression.Service value in argument to HandleDisassembleItem: *MockProgressionService does not implement progression.Service (missing method AddContribution)
internal/handler/inventory_test.go:257:29: cannot use mockSvc (variable of type *MockUserService) as "github.com/osse101/BrandishBot_Go/internal/user".Service value in argument to HandleAddItem: *MockUserService does not implement "github.com/osse101/BrandishBot_Go/internal/user".Service (missing method GetLinkedPlatforms)
internal/handler/inventory_test.go:415:30: cannot use mockEco (variable of type *MockEconomyService) as economy.Service value in argument to HandleSellItem: *MockEconomyService does not implement economy.Service (missing method GetBuyablePrices)
internal/handler/inventory_test.go:415:39: cannot use mockProg (variable of type *MockProgressionService) as progression.Service value in argument to HandleSellItem: *MockProgressionService does not implement progression.Service (missing method AddContribution)
internal/handler/inventory_test.go:480:32: cannot use mockSvc (variable of type *MockUserService) as "github.com/osse101/BrandishBot_Go/internal/user".Service value in argument to HandleRemoveItem: *MockUserService does not implement "github.com/osse101/BrandishBot_Go/internal/user".Service (missing method GetLinkedPlatforms)
internal/handler/inventory_test.go:550:30: cannot use mockSvc (variable of type *MockUserService) as "github.com/osse101/BrandishBot_Go/internal/user".Service value in argument to HandleGiveItem: *MockUserService does not implement "github.com/osse101/BrandishBot_Go/internal/user".Service (missing method GetLinkedPlatforms)
internal/handler/inventory_test.go:708:29: cannot use mockEco (variable of type *MockEconomyService) as economy.Service value in argument to HandleBuyItem: *MockEconomyService does not implement economy.Service (missing method GetBuyablePrices)
internal/handler/inventory_test.go:708:38: cannot use mockProg (variable of type *MockProgressionService) as progression.Service value in argument to HandleBuyItem: *MockProgressionService does not implement progression.Service (missing method AddContribution)
internal/handler/inventory_test.go:778:29: cannot use mockUser (variable of type *MockUserService) as "github.com/osse101/BrandishBot_Go/internal/user".Service value in argument to HandleUseItem: *MockUserService does not implement "github.com/osse101/BrandishBot_Go/internal/user".Service (missing method GetLinkedPlatforms)
internal/handler/inventory_test.go:850:34: cannot use mockSvc (variable of type *MockUserService) as "github.com/osse101/BrandishBot_Go/internal/user".Service value in argument to HandleGetInventory: *MockUserService does not implement "github.com/osse101/BrandishBot_Go/internal/user".Service (missing method GetLinkedPlatforms)
internal/handler/inventory_test.go:850:34: too many errors
=== RUN   TestPricesCommand_Buy
--- PASS: TestPricesCommand_Buy (0.01s)
=== RUN   TestPricesCommand_Sell
--- PASS: TestPricesCommand_Sell (0.00s)
=== RUN   TestInfoCommand_Overview
--- PASS: TestInfoCommand_Overview (0.00s)
=== RUN   TestInfoCommand_SpecificFeature
--- PASS: TestInfoCommand_SpecificFeature (0.00s)
=== RUN   TestInfoCommand_FileNotFound
time=2025-12-19T09:32:57.380Z level=ERROR msg="Failed to load info text" service=brandish-bot version=dev environment=dev feature=missing error="failed to read info file: open /tmp/info_test3231938379/missing.txt: no such file or directory"
--- PASS: TestInfoCommand_FileNotFound (0.00s)
=== RUN   TestInventoryCommand_Empty
--- PASS: TestInventoryCommand_Empty (0.00s)
=== RUN   TestInventoryCommand_WithItems
--- PASS: TestInventoryCommand_WithItems (0.00s)
=== RUN   TestInventoryCommand_RegisterError
time=2025-12-19T09:32:57.390Z level=WARN msg="Server error, will retry" service=brandish-bot version=dev environment=dev status=500 attempt=0
time=2025-12-19T09:32:57.979Z level=INFO msg="Retrying API request" service=brandish-bot version=dev environment=dev attempt=1 path=/user/register delay=587ms
time=2025-12-19T09:32:57.981Z level=WARN msg="Server error, will retry" service=brandish-bot version=dev environment=dev status=500 attempt=1
time=2025-12-19T09:32:58.985Z level=INFO msg="Retrying API request" service=brandish-bot version=dev environment=dev attempt=2 path=/user/register delay=1.004s
time=2025-12-19T09:32:58.987Z level=WARN msg="Server error, will retry" service=brandish-bot version=dev environment=dev status=500 attempt=2
time=2025-12-19T09:33:01.009Z level=INFO msg="Retrying API request" service=brandish-bot version=dev environment=dev attempt=3 path=/user/register delay=2.021s
time=2025-12-19T09:33:01.012Z level=WARN msg="Server error, will retry" service=brandish-bot version=dev environment=dev status=500 attempt=3
time=2025-12-19T09:33:01.012Z level=ERROR msg="Failed to register user" service=brandish-bot version=dev environment=dev error="max retries exceeded: server error: 500"
--- PASS: TestInventoryCommand_RegisterError (3.63s)
=== RUN   TestProfileCommand_Success
    cmd_profile_test.go:65: Embed Title: Tester's Profile
    cmd_profile_test.go:67: Field 0: Name='User ID' Value='u-123'
    cmd_profile_test.go:67: Field 1: Name='Items' Value='2'
--- PASS: TestProfileCommand_Success (0.00s)
=== RUN   TestProfileCommand_RegisterError
time=2025-12-19T09:33:01.017Z level=WARN msg="Server error, will retry" service=brandish-bot version=dev environment=dev status=500 attempt=0
time=2025-12-19T09:33:01.539Z level=INFO msg="Retrying API request" service=brandish-bot version=dev environment=dev attempt=1 path=/user/register delay=522ms
time=2025-12-19T09:33:01.541Z level=WARN msg="Server error, will retry" service=brandish-bot version=dev environment=dev status=500 attempt=1
time=2025-12-19T09:33:02.557Z level=INFO msg="Retrying API request" service=brandish-bot version=dev environment=dev attempt=2 path=/user/register delay=1.016s
time=2025-12-19T09:33:02.560Z level=WARN msg="Server error, will retry" service=brandish-bot version=dev environment=dev status=500 attempt=2
time=2025-12-19T09:33:04.598Z level=INFO msg="Retrying API request" service=brandish-bot version=dev environment=dev attempt=3 path=/user/register delay=2.038s
time=2025-12-19T09:33:04.600Z level=WARN msg="Server error, will retry" service=brandish-bot version=dev environment=dev status=500 attempt=3
time=2025-12-19T09:33:04.600Z level=ERROR msg="Failed to register user" service=brandish-bot version=dev environment=dev error="max retries exceeded: server error: 500"
--- PASS: TestProfileCommand_RegisterError (3.59s)
=== RUN   TestCommandRegistry
--- PASS: TestCommandRegistry (0.00s)
=== RUN   TestRecordCommand
--- PASS: TestRecordCommand (0.00s)
=== RUN   TestHealthStatus
--- PASS: TestHealthStatus (0.00s)
=== RUN   TestMockAPIClient
--- PASS: TestMockAPIClient (0.00s)
=== RUN   TestEconomyCommands
=== RUN   TestEconomyCommands/Buy_Item
=== RUN   TestEconomyCommands/Sell_Item
=== RUN   TestEconomyCommands/Get_Sell_Prices
=== RUN   TestEconomyCommands/Get_Buy_Prices
--- PASS: TestEconomyCommands (0.00s)
    --- PASS: TestEconomyCommands/Buy_Item (0.00s)
    --- PASS: TestEconomyCommands/Sell_Item (0.00s)
    --- PASS: TestEconomyCommands/Get_Sell_Prices (0.00s)
    --- PASS: TestEconomyCommands/Get_Buy_Prices (0.00s)
=== RUN   TestCraftingCommands
=== RUN   TestCraftingCommands/Upgrade_Item
=== RUN   TestCraftingCommands/Disassemble_Item
=== RUN   TestCraftingCommands/Get_Recipes
--- PASS: TestCraftingCommands (0.00s)
    --- PASS: TestCraftingCommands/Upgrade_Item (0.00s)
    --- PASS: TestCraftingCommands/Disassemble_Item (0.00s)
    --- PASS: TestCraftingCommands/Get_Recipes (0.00s)
=== RUN   TestStatsCommands
--- PASS: TestStatsCommands (0.00s)
=== RUN   TestAdminCommands
--- PASS: TestAdminCommands (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/discord	7.242s
?   	github.com/osse101/BrandishBot_Go/internal/domain	[no test files]
=== RUN   TestBuyItem_NoGoroutineLeak
time=2025-12-19T09:32:57.390Z level=INFO msg="BuyItem called" service=brandish-bot version=dev environment=dev platform=discord platformID=discord-id username=tester item=Lootbox1 quantity=1
time=2025-12-19T09:32:57.390Z level=INFO msg="Item purchased" service=brandish-bot version=dev environment=dev username=tester item=Lootbox1 quantity=1
time=2025-12-19T09:32:57.390Z level=INFO msg="Economy service shutting down, waiting for background tasks..." service=brandish-bot version=dev environment=dev
--- PASS: TestBuyItem_NoGoroutineLeak (0.12s)
=== RUN   TestService_Shutdown_NoGoroutineLeak
time=2025-12-19T09:32:57.506Z level=INFO msg="Economy service shutting down, waiting for background tasks..." service=brandish-bot version=dev environment=dev
--- PASS: TestService_Shutdown_NoGoroutineLeak (0.11s)
=== RUN   TestSellItem_Success
time=2025-12-19T09:32:57.610Z level=INFO msg="SellItem called" service=brandish-bot version=dev environment=dev platform=twitch platformID="" username=testuser item=Sword quantity=3
--- FAIL: TestSellItem_Success (0.00s)
panic:
	assert: mock: I don't know what to return because the method call was unexpected.
		Either do Mock.On("BeginTx").Return(...) first, or remove the BeginTx() call.
		This method was unexpected:
			BeginTx(context.backgroundCtx)
			0: context.backgroundCtx{emptyCtx:context.emptyCtx{}}
		at: [/app/internal/economy/service_test.go:71 /app/internal/economy/service.go:138 /app/internal/economy/service_test.go:152] [recovered]
	panic:
	assert: mock: I don't know what to return because the method call was unexpected.
		Either do Mock.On("BeginTx").Return(...) first, or remove the BeginTx() call.
		This method was unexpected:
			BeginTx(context.backgroundCtx)
			0: context.backgroundCtx{emptyCtx:context.emptyCtx{}}
		at: [/app/internal/economy/service_test.go:71 /app/internal/economy/service.go:138 /app/internal/economy/service_test.go:152]

goroutine 21 [running]:
testing.tRunner.func1.2({0x637bc0, 0xc00011c8b0})
	/usr/local/go/src/testing/testing.go:1734 +0x21c
testing.tRunner.func1()
	/usr/local/go/src/testing/testing.go:1737 +0x35e
panic({0x637bc0?, 0xc00011c8b0?})
	/usr/local/go/src/runtime/panic.go:792 +0x132
github.com/stretchr/testify/mock.(*Mock).fail(0xc000128140, {0x69e887?, 0x4?}, {0xc000126f00?, 0x1?, 0x1?})
	/home/jules/go/pkg/mod/github.com/stretchr/testify@v1.11.1/mock/mock.go:359 +0x125
github.com/stretchr/testify/mock.(*Mock).MethodCalled(0xc000128140, {0x72b978, 0x7}, {0xc00011c7a0, 0x1, 0x1})
	/home/jules/go/pkg/mod/github.com/stretchr/testify@v1.11.1/mock/mock.go:527 +0x785
github.com/stretchr/testify/mock.(*Mock).Called(0xc000128140, {0xc00011c7a0, 0x1, 0x1})
	/home/jules/go/pkg/mod/github.com/stretchr/testify@v1.11.1/mock/mock.go:491 +0x125
github.com/osse101/BrandishBot_Go/internal/economy.(*MockRepository).BeginTx(0xc000128140, {0x6ec488, 0x8c97c0})
	/app/internal/economy/service_test.go:71 +0x95
github.com/osse101/BrandishBot_Go/internal/economy.(*service).SellItem(0xc000202060, {0x6ec488, 0x8c97c0}, {0x68d09b, 0x6}, {0x0, 0x0}, {0x68d87b, 0x8}, {0x68cdd6, ...}, ...)
	/app/internal/economy/service.go:138 +0x2fc
github.com/osse101/BrandishBot_Go/internal/economy.TestSellItem_Success(0xc0000828c0)
	/app/internal/economy/service_test.go:152 +0x605
testing.tRunner(0xc0000828c0, 0x6a4580)
	/usr/local/go/src/testing/testing.go:1792 +0xf4
created by testing.(*T).Run in goroutine 1
	/usr/local/go/src/testing/testing.go:1851 +0x413
FAIL	github.com/osse101/BrandishBot_Go/internal/economy	0.243s
=== RUN   TestMemoryBus_PublishSubscribe
--- PASS: TestMemoryBus_PublishSubscribe (0.00s)
=== RUN   TestMemoryBus_PublishMultipleHandlers
--- PASS: TestMemoryBus_PublishMultipleHandlers (0.00s)
=== RUN   TestMemoryBus_PublishError
--- PASS: TestMemoryBus_PublishError (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/event	0.005s
=== RUN   TestCleanupJob_Process
time=2025-12-19T09:32:57.789Z level=INFO msg="Starting event log cleanup job" service=brandish-bot version=dev environment=dev retentionDays=10
time=2025-12-19T09:32:57.790Z level=INFO msg="Event log cleanup completed" service=brandish-bot version=dev environment=dev deletedCount=100 duration=61.531Âµs
--- PASS: TestCleanupJob_Process (0.00s)
=== RUN   TestService_Subscribe
--- PASS: TestService_Subscribe (0.00s)
=== RUN   TestService_HandleEvent
--- PASS: TestService_HandleEvent (0.00s)
=== RUN   TestService_CleanupOldEvents
--- PASS: TestService_CleanupOldEvents (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/eventlog	0.007s
=== RUN   TestStartGamble_Success
time=2025-12-19T09:32:57.961Z level=INFO msg="StartGamble called" service=brandish-bot version=dev environment=dev platform=twitch platformID=123 username=testuser bets="[{ItemID:1 Quantity:2}]"
--- PASS: TestStartGamble_Success (0.00s)
=== RUN   TestStartGamble_NoBets
time=2025-12-19T09:32:57.962Z level=INFO msg="StartGamble called" service=brandish-bot version=dev environment=dev platform=twitch platformID=123 username=testuser bets=[]
--- PASS: TestStartGamble_NoBets (0.00s)
=== RUN   TestStartGamble_InvalidBetQuantity
time=2025-12-19T09:32:57.962Z level=INFO msg="StartGamble called" service=brandish-bot version=dev environment=dev platform=twitch platformID=123 username=testuser bets="[{ItemID:1 Quantity:0}]"
--- PASS: TestStartGamble_InvalidBetQuantity (0.00s)
=== RUN   TestStartGamble_UserNotFound
time=2025-12-19T09:32:57.962Z level=INFO msg="StartGamble called" service=brandish-bot version=dev environment=dev platform=twitch platformID=123 username=testuser bets="[{ItemID:1 Quantity:1}]"
--- PASS: TestStartGamble_UserNotFound (0.00s)
=== RUN   TestStartGamble_ActiveGambleExists
time=2025-12-19T09:32:57.963Z level=INFO msg="StartGamble called" service=brandish-bot version=dev environment=dev platform=twitch platformID=123 username=testuser bets="[{ItemID:1 Quantity:1}]"
--- PASS: TestStartGamble_ActiveGambleExists (0.00s)
=== RUN   TestStartGamble_InsufficientLootboxes
time=2025-12-19T09:32:57.963Z level=INFO msg="StartGamble called" service=brandish-bot version=dev environment=dev platform=twitch platformID=123 username=testuser bets="[{ItemID:1 Quantity:5}]"
--- PASS: TestStartGamble_InsufficientLootboxes (0.00s)
=== RUN   TestStartGamble_LootboxNotInInventory
time=2025-12-19T09:32:57.963Z level=INFO msg="StartGamble called" service=brandish-bot version=dev environment=dev platform=twitch platformID=123 username=testuser bets="[{ItemID:99 Quantity:1}]"
--- PASS: TestStartGamble_LootboxNotInInventory (0.00s)
=== RUN   TestJoinGamble_Success
time=2025-12-19T09:32:57.963Z level=INFO msg="JoinGamble called" service=brandish-bot version=dev environment=dev gambleID=d5cf0af0-993a-499b-9478-9adc0f1067c3 username=joiner
--- PASS: TestJoinGamble_Success (0.00s)
=== RUN   TestJoinGamble_NoBets
time=2025-12-19T09:32:57.964Z level=INFO msg="JoinGamble called" service=brandish-bot version=dev environment=dev gambleID=abddc177-3901-405a-aa24-4f7248f614ee username=joiner
--- PASS: TestJoinGamble_NoBets (0.00s)
=== RUN   TestJoinGamble_GambleNotFound
time=2025-12-19T09:32:57.964Z level=INFO msg="JoinGamble called" service=brandish-bot version=dev environment=dev gambleID=0c5e7b10-6c13-4750-8869-6595373f3bc5 username=joiner
--- PASS: TestJoinGamble_GambleNotFound (0.00s)
=== RUN   TestJoinGamble_WrongState
time=2025-12-19T09:32:57.964Z level=INFO msg="JoinGamble called" service=brandish-bot version=dev environment=dev gambleID=9ea0dc81-8b56-4409-b419-cb6d57ec6558 username=joiner
--- PASS: TestJoinGamble_WrongState (0.00s)
=== RUN   TestJoinGamble_DeadlinePassed
time=2025-12-19T09:32:57.964Z level=INFO msg="JoinGamble called" service=brandish-bot version=dev environment=dev gambleID=9621fb9c-baf5-4192-ad05-e976a40fcbe3 username=joiner
--- PASS: TestJoinGamble_DeadlinePassed (0.00s)
=== RUN   TestJoinGamble_InsufficientLootboxes
time=2025-12-19T09:32:57.964Z level=INFO msg="JoinGamble called" service=brandish-bot version=dev environment=dev gambleID=f5051b13-0464-4ed8-b427-ed1cc6603839 username=joiner
--- PASS: TestJoinGamble_InsufficientLootboxes (0.00s)
=== RUN   TestExecuteGamble_Success
time=2025-12-19T09:32:57.964Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=12c48969-7b5a-4a74-9d3f-74b50e59bc0d
--- PASS: TestExecuteGamble_Success (0.00s)
=== RUN   TestExecuteGamble_MultipleParticipants
time=2025-12-19T09:32:57.965Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=3b1e408d-a136-4769-80d7-a0ffe720781e
time=2025-12-19T09:32:57.965Z level=INFO msg="Tie-break resolved" service=brandish-bot version=dev environment=dev winnerID=user2 originalValue=50
--- PASS: TestExecuteGamble_MultipleParticipants (0.00s)
=== RUN   TestExecuteGamble_GambleNotFound
time=2025-12-19T09:32:57.965Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=1b92e6f8-0ef7-4488-84e9-cfdd4b4297a0
--- PASS: TestExecuteGamble_GambleNotFound (0.00s)
=== RUN   TestExecuteGamble_AlreadyCompleted
time=2025-12-19T09:32:57.965Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=71605388-6570-4d51-a7aa-e86d5fbe5ed1
time=2025-12-19T09:32:57.966Z level=INFO msg="Gamble already completed, skipping execution" service=brandish-bot version=dev environment=dev gambleID=71605388-6570-4d51-a7aa-e86d5fbe5ed1
--- PASS: TestExecuteGamble_AlreadyCompleted (0.00s)
=== RUN   TestExecuteGamble_WrongState
time=2025-12-19T09:32:57.966Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=9b4fce56-81d6-4df2-85c4-e56cc8879ec7
--- PASS: TestExecuteGamble_WrongState (0.00s)
=== RUN   TestExecuteGamble_StateUpdateFails
time=2025-12-19T09:32:57.966Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=e621b8b7-69d5-4e96-96a9-239aaaf9437c
--- PASS: TestExecuteGamble_StateUpdateFails (0.00s)
=== RUN   TestExecuteGamble_SaveOpenedItemsFails
time=2025-12-19T09:32:57.966Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=cd83d66a-430c-4fe3-a0dd-85af47a83984
--- PASS: TestExecuteGamble_SaveOpenedItemsFails (0.00s)
=== RUN   TestGetGamble_Success
--- PASS: TestGetGamble_Success (0.00s)
=== RUN   TestGetActiveGamble_Success
--- PASS: TestGetActiveGamble_Success (0.00s)
=== RUN   TestGetActiveGamble_NoActiveGamble
--- PASS: TestGetActiveGamble_NoActiveGamble (0.00s)
=== RUN   TestExecuteGamble_NearMiss
time=2025-12-19T09:32:57.967Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=4ff62d17-30b1-498b-825e-7da313078c38
--- PASS: TestExecuteGamble_NearMiss (0.00s)
=== RUN   TestExecuteGamble_CriticalFailure
time=2025-12-19T09:32:57.967Z level=INFO msg="ExecuteGamble called" service=brandish-bot version=dev environment=dev gambleID=3969d04b-da9f-4268-a1c8-733bd26c47ef
time=2025-12-19T09:32:57.968Z level=INFO msg="Tie-break resolved" service=brandish-bot version=dev environment=dev winnerID=user1 originalValue=100
--- PASS: TestExecuteGamble_CriticalFailure (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/gamble	0.015s
FAIL	github.com/osse101/BrandishBot_Go/internal/handler [build failed]
=== RUN   TestCalculateLevel
--- PASS: TestCalculateLevel (0.00s)
=== RUN   TestGetXPForLevel
--- PASS: TestGetXPForLevel (0.00s)
=== RUN   TestAwardXP_Success
time=2025-12-19T09:32:58.278Z level=INFO msg="Awarded job XP" service=brandish-bot version=dev environment=dev user_id=user1 job=blacksmith xp=10 new_level=0 leveled_up=false
--- PASS: TestAwardXP_Success (0.00s)
=== RUN   TestAwardXP_LevelUp
time=2025-12-19T09:32:58.279Z level=INFO msg="Awarded job XP" service=brandish-bot version=dev environment=dev user_id=user1 job=blacksmith xp=150 new_level=1 leveled_up=true
--- PASS: TestAwardXP_LevelUp (0.00s)
=== RUN   TestAwardXP_Locked
--- PASS: TestAwardXP_Locked (0.00s)
=== RUN   TestAwardXP_DailyCap
time=2025-12-19T09:32:58.279Z level=INFO msg="Awarded job XP" service=brandish-bot version=dev environment=dev user_id=u1 job=blacksmith xp=500 new_level=2 leveled_up=true
--- PASS: TestAwardXP_DailyCap (0.00s)
=== RUN   TestAwardXP_DailyCap_Reached
time=2025-12-19T09:32:58.279Z level=INFO msg="Daily XP cap reached" service=brandish-bot version=dev environment=dev user_id=u1 job=blacksmith
--- PASS: TestAwardXP_DailyCap_Reached (0.00s)
=== RUN   TestAwardXP_MaxLevel
time=2025-12-19T09:32:58.279Z level=INFO msg="Awarded job XP" service=brandish-bot version=dev environment=dev user_id=u1 job=blacksmith xp=10 new_level=10 leveled_up=false
--- PASS: TestAwardXP_MaxLevel (0.00s)
=== RUN   TestGetJobBonus
--- PASS: TestGetJobBonus (0.00s)
=== RUN   TestGetPrimaryJob
--- PASS: TestGetPrimaryJob (0.00s)
=== RUN   TestGetAllJobs_Success
--- PASS: TestGetAllJobs_Success (0.00s)
=== RUN   TestGetAllJobs_Empty
--- PASS: TestGetAllJobs_Empty (0.00s)
=== RUN   TestGetAllJobs_RepositoryError
--- PASS: TestGetAllJobs_RepositoryError (0.00s)
=== RUN   TestGetUserJobs_NoProgress
--- PASS: TestGetUserJobs_NoProgress (0.00s)
=== RUN   TestGetUserJobs_RepositoryError
--- PASS: TestGetUserJobs_RepositoryError (0.00s)
=== RUN   TestGetUserJobs_UserJobsError
--- PASS: TestGetUserJobs_UserJobsError (0.00s)
=== RUN   TestGetPrimaryJob_NoJobs
--- PASS: TestGetPrimaryJob_NoJobs (0.00s)
=== RUN   TestGetPrimaryJob_TieOnLevel_HigherXP
--- PASS: TestGetPrimaryJob_TieOnLevel_HigherXP (0.00s)
=== RUN   TestGetPrimaryJob_ErrorPropagation
--- PASS: TestGetPrimaryJob_ErrorPropagation (0.00s)
=== RUN   TestGetJobLevel_JobNotFound
--- PASS: TestGetJobLevel_JobNotFound (0.00s)
=== RUN   TestGetJobLevel_RepositoryError
--- PASS: TestGetJobLevel_RepositoryError (0.00s)
=== RUN   TestGetJobLevel_NoProgress
--- PASS: TestGetJobLevel_NoProgress (0.00s)
=== RUN   TestGetJobBonus_ZeroLevel
--- PASS: TestGetJobBonus_ZeroLevel (0.00s)
=== RUN   TestGetJobBonus_NoBonusesConfigured
--- PASS: TestGetJobBonus_NoBonusesConfigured (0.00s)
=== RUN   TestGetJobBonus_MultipleBonusTypes
--- PASS: TestGetJobBonus_MultipleBonusTypes (0.00s)
=== RUN   TestGetJobBonus_RepositoryError
--- PASS: TestGetJobBonus_RepositoryError (0.00s)
=== RUN   TestAwardXP_RepositoryFailure_GetJob
--- PASS: TestAwardXP_RepositoryFailure_GetJob (0.00s)
=== RUN   TestAwardXP_RepositoryFailure_Upsert
--- PASS: TestAwardXP_RepositoryFailure_Upsert (0.00s)
=== RUN   TestAwardXP_PartialDailyCapRemaining
time=2025-12-19T09:32:58.283Z level=INFO msg="Awarded job XP" service=brandish-bot version=dev environment=dev user_id=u1 job=blacksmith xp=100 new_level=4 leveled_up=false
--- PASS: TestAwardXP_PartialDailyCapRemaining (0.00s)
=== RUN   TestGetXPForLevel_NegativeLevel
--- PASS: TestGetXPForLevel_NegativeLevel (0.00s)
=== RUN   TestGetXPForLevel_VeryHighLevel
--- PASS: TestGetXPForLevel_VeryHighLevel (0.00s)
=== RUN   TestCalculateLevel_VeryHighXP
--- PASS: TestCalculateLevel_VeryHighXP (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/job	0.011s
=== RUN   TestUnlinkCache_Concurrency
--- PASS: TestUnlinkCache_Concurrency (0.00s)
=== RUN   TestConfirmLink_SourceUserCreationFlow
time=2025-12-19T09:32:58.422Z level=INFO msg="Accounts merged" service=brandish-bot version=dev environment=dev primary_id=new-source-id secondary_id=existing-user-id
--- PASS: TestConfirmLink_SourceUserCreationFlow (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/linking	0.009s
=== RUN   TestJSONLogging
--- PASS: TestJSONLogging (0.00s)
=== RUN   TestRequestIDContext
--- PASS: TestRequestIDContext (0.00s)
=== RUN   TestConfigDefaults
--- PASS: TestConfigDefaults (0.00s)
=== RUN   TestProductionConfig
--- PASS: TestProductionConfig (0.00s)
=== RUN   TestDevelopmentConfig
--- PASS: TestDevelopmentConfig (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/logger	0.006s
=== RUN   TestOpenLootbox
--- PASS: TestOpenLootbox (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/lootbox	0.005s
?   	github.com/osse101/BrandishBot_Go/internal/metrics	[no test files]
=== RUN   TestWithUserID_GetUserID
=== RUN   TestWithUserID_GetUserID/stores_and_retrieves_user_ID_from_context
=== RUN   TestWithUserID_GetUserID/returns_empty_string_for_context_without_user_ID
=== RUN   TestWithUserID_GetUserID/handles_context_with_wrong_type_value
=== RUN   TestWithUserID_GetUserID/preserves_other_context_values
--- PASS: TestWithUserID_GetUserID (0.00s)
    --- PASS: TestWithUserID_GetUserID/stores_and_retrieves_user_ID_from_context (0.00s)
    --- PASS: TestWithUserID_GetUserID/returns_empty_string_for_context_without_user_ID (0.00s)
    --- PASS: TestWithUserID_GetUserID/handles_context_with_wrong_type_value (0.00s)
    --- PASS: TestWithUserID_GetUserID/preserves_other_context_values (0.00s)
=== RUN   TestExtractUserID
=== RUN   TestExtractUserID/extracts_from_context_using_typed_key
=== RUN   TestExtractUserID/extracts_from_query_parameter
=== RUN   TestExtractUserID/query_parameter_used_when_no_context_value
=== RUN   TestExtractUserID/returns_empty_when_no_user_ID_found
--- PASS: TestExtractUserID (0.00s)
    --- PASS: TestExtractUserID/extracts_from_context_using_typed_key (0.00s)
    --- PASS: TestExtractUserID/extracts_from_query_parameter (0.00s)
    --- PASS: TestExtractUserID/query_parameter_used_when_no_context_value (0.00s)
    --- PASS: TestExtractUserID/returns_empty_when_no_user_ID_found (0.00s)
=== RUN   TestUserIDKey
=== RUN   TestUserIDKey/context_keys_are_distinct
=== RUN   TestUserIDKey/setting_same_key_overwrites_previous_value
--- PASS: TestUserIDKey (0.00s)
    --- PASS: TestUserIDKey/context_keys_are_distinct (0.00s)
    --- PASS: TestUserIDKey/setting_same_key_overwrites_previous_value (0.00s)
=== RUN   TestEngagementTracker_Track
=== RUN   TestEngagementTracker_Track/tracks_engagement_with_user_ID_in_context
=== RUN   TestEngagementTracker_Track/tracks_engagement_with_custom_value_function
=== RUN   TestEngagementTracker_Track/does_not_track_when_no_user_ID
=== RUN   TestEngagementTracker_Track/continues_handler_execution_even_if_event_publish_fails
time=2025-12-19T09:32:58.909Z level=ERROR msg="Failed to publish engagement event" service=brandish-bot version=dev environment=dev error="assert.AnError general error for testing" user_id=testuser metric=test_metric
--- PASS: TestEngagementTracker_Track (0.00s)
    --- PASS: TestEngagementTracker_Track/tracks_engagement_with_user_ID_in_context (0.00s)
    --- PASS: TestEngagementTracker_Track/tracks_engagement_with_custom_value_function (0.00s)
    --- PASS: TestEngagementTracker_Track/does_not_track_when_no_user_ID (0.00s)
    --- PASS: TestEngagementTracker_Track/continues_handler_execution_even_if_event_publish_fails (0.00s)
=== RUN   TestEngagementTracker_TrackCommand
=== RUN   TestEngagementTracker_TrackCommand/tracks_command_execution_with_metadata
=== RUN   TestEngagementTracker_TrackCommand/does_not_track_when_no_user_ID
--- PASS: TestEngagementTracker_TrackCommand (0.00s)
    --- PASS: TestEngagementTracker_TrackCommand/tracks_command_execution_with_metadata (0.00s)
    --- PASS: TestEngagementTracker_TrackCommand/does_not_track_when_no_user_ID (0.00s)
=== RUN   TestTrackEngagementFromContext
=== RUN   TestTrackEngagementFromContext/tracks_engagement_from_context
=== RUN   TestTrackEngagementFromContext/does_nothing_when_no_user_ID_in_context
=== RUN   TestTrackEngagementFromContext/logs_error_when_publish_fails
time=2025-12-19T09:32:58.910Z level=ERROR msg="Failed to publish engagement event from context" service=brandish-bot version=dev environment=dev error="assert.AnError general error for testing" user_id=ctx-user metric=manual_metric
--- PASS: TestTrackEngagementFromContext (0.00s)
    --- PASS: TestTrackEngagementFromContext/tracks_engagement_from_context (0.00s)
    --- PASS: TestTrackEngagementFromContext/does_nothing_when_no_user_ID_in_context (0.00s)
    --- PASS: TestTrackEngagementFromContext/logs_error_when_publish_fails (0.00s)
=== RUN   TestNewEngagementTracker
=== RUN   TestNewEngagementTracker/creates_tracker_with_event_bus
--- PASS: TestNewEngagementTracker (0.00s)
    --- PASS: TestNewEngagementTracker/creates_tracker_with_event_bus (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/middleware	0.007s
=== RUN   TestGetActiveVotingSession_Success
time=2025-12-19T09:32:59.207Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
--- PASS: TestGetActiveVotingSession_Success (0.00s)
=== RUN   TestGetActiveVotingSession_NoSession
--- PASS: TestGetActiveVotingSession_NoSession (0.00s)
=== RUN   TestCheckAndUnlockCriteria_TriggersUnlock
time=2025-12-19T09:32:59.207Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1 contributions=500 rollover=0
--- PASS: TestCheckAndUnlockCriteria_TriggersUnlock (0.00s)
=== RUN   TestCheckAndUnlockCriteria_NoUnlock_StartsSession
--- PASS: TestCheckAndUnlockCriteria_NoUnlock_StartsSession (0.00s)
=== RUN   TestGetContributionLeaderboard_Success
--- PASS: TestGetContributionLeaderboard_Success (0.00s)
=== RUN   TestGetContributionLeaderboard_ClampLimit
--- PASS: TestGetContributionLeaderboard_ClampLimit (0.00s)
=== RUN   TestGetProgressionStatus_Complete
--- PASS: TestGetProgressionStatus_Complete (0.00s)
=== RUN   TestGetProgressionStatus_WithActiveSession
time=2025-12-19T09:32:59.207Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
--- PASS: TestGetProgressionStatus_WithActiveSession (0.00s)
=== RUN   TestVotingFlow_Complete
time=2025-12-19T09:32:59.207Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.207Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_money sessionID=1
time=2025-12-19T09:32:59.207Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user2 nodeKey=item_money sessionID=1
time=2025-12-19T09:32:59.207Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user3 nodeKey=item_money sessionID=1
time=2025-12-19T09:32:59.207Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=2 votes=3 voterCount=3
time=2025-12-19T09:32:59.207Z level=INFO msg="Unlock threshold met, triggering unlock" service=brandish-bot version=dev environment=dev accumulated=500 required=500
time=2025-12-19T09:32:59.207Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1 contributions=500 rollover=0
time=2025-12-19T09:32:59.207Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=2 options=2
time=2025-12-19T09:32:59.207Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.207Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
--- PASS: TestVotingFlow_Complete (0.02s)
=== RUN   TestVotingFlow_MultipleVoters
time=2025-12-19T09:32:59.228Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.228Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.228Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user2 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.228Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user3 nodeKey=item_money sessionID=1
time=2025-12-19T09:32:59.228Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=4 votes=2 voterCount=3
--- PASS: TestVotingFlow_MultipleVoters (0.00s)
=== RUN   TestVotingFlow_AutoNextSession
time=2025-12-19T09:32:59.228Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.228Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.228Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=4 votes=1 voterCount=1
time=2025-12-19T09:32:59.228Z level=INFO msg="Unlock threshold met, triggering unlock" service=brandish-bot version=dev environment=dev accumulated=500 required=500
time=2025-12-19T09:32:59.228Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_lootbox0 level=1 contributions=500 rollover=0
time=2025-12-19T09:32:59.228Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=2 options=4
--- PASS: TestVotingFlow_AutoNextSession (0.02s)
=== RUN   TestMultiLevel_Progressive
time=2025-12-19T09:32:59.248Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=4
--- PASS: TestMultiLevel_Progressive (0.00s)
=== RUN   TestMultiLevel_SessionTargeting
time=2025-12-19T09:32:59.248Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=4
time=2025-12-19T09:32:59.249Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=upgrade_cooldown_reduction sessionID=1
time=2025-12-19T09:32:59.249Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=5 votes=1 voterCount=1
time=2025-12-19T09:32:59.249Z level=INFO msg="Unlock threshold met, triggering unlock" service=brandish-bot version=dev environment=dev accumulated=1500 required=1500
time=2025-12-19T09:32:59.249Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=upgrade_cooldown_reduction level=1 contributions=1500 rollover=0
time=2025-12-19T09:32:59.249Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=2 options=4
--- PASS: TestMultiLevel_SessionTargeting (0.02s)
=== RUN   TestRollover_ExcessPoints
time=2025-12-19T09:32:59.269Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1 contributions=650 rollover=150
--- PASS: TestRollover_ExcessPoints (0.00s)
=== RUN   TestCache_ThresholdDetection
time=2025-12-19T09:32:59.269Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.269Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.269Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=4 votes=1 voterCount=1
time=2025-12-19T09:32:59.269Z level=INFO msg="Unlock threshold met, triggering unlock" service=brandish-bot version=dev environment=dev accumulated=510 required=500
time=2025-12-19T09:32:59.269Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_lootbox0 level=1 contributions=510 rollover=10
time=2025-12-19T09:32:59.269Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=2 options=4
time=2025-12-19T09:32:59.269Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
--- PASS: TestCache_ThresholdDetection (0.10s)
=== RUN   TestGetProgressionTree
--- PASS: TestGetProgressionTree (0.00s)
=== RUN   TestGetAvailableUnlocks
--- PASS: TestGetAvailableUnlocks (0.00s)
=== RUN   TestVoteForUnlock
    service_test.go:761: Obsolete test - voting now uses session-based system
--- SKIP: TestVoteForUnlock (0.00s)
=== RUN   TestIsFeatureUnlocked
--- PASS: TestIsFeatureUnlocked (0.00s)
=== RUN   TestIsItemUnlocked
--- PASS: TestIsItemUnlocked (0.00s)
=== RUN   TestEngagementTracking
--- PASS: TestEngagementTracking (0.00s)
=== RUN   TestAdminUnlock
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1
--- PASS: TestAdminUnlock (0.00s)
=== RUN   TestAdminRelock
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin relocked node" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1
--- PASS: TestAdminRelock (0.00s)
=== RUN   TestResetProgressionTree
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=feature_economy level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Resetting progression tree" service=brandish-bot version=dev environment=dev resetBy=admin reason="test reset"
--- PASS: TestResetProgressionTree (0.00s)
=== RUN   TestMultiLevelUnlock
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=upgrade_cooldown_reduction level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=upgrade_cooldown_reduction level=2
--- PASS: TestMultiLevelUnlock (0.00s)
=== RUN   TestUnlockAllFeatures
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=feature_buy level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=feature_sell level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=feature_upgrade level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=feature_disassemble level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=feature_economy level=1
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=feature_search level=1
--- PASS: TestUnlockAllFeatures (0.00s)
=== RUN   TestUnlockFeature
time=2025-12-19T09:32:59.370Z level=INFO msg="Admin unlocked node" service=brandish-bot version=dev environment=dev nodeKey=feature_buy level=1
--- PASS: TestUnlockFeature (0.00s)
=== RUN   TestCheckAndUnlock_Success
time=2025-12-19T09:32:59.370Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1 contributions=500 rollover=0
--- PASS: TestCheckAndUnlock_Success (0.00s)
=== RUN   TestCheckAndUnlock_Rollover
time=2025-12-19T09:32:59.370Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1 contributions=600 rollover=100
--- PASS: TestCheckAndUnlock_Rollover (0.00s)
=== RUN   TestCheckAndUnlock_StartsNewSession
time=2025-12-19T09:32:59.370Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1 contributions=500 rollover=0
time=2025-12-19T09:32:59.371Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.371Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.371Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
--- PASS: TestCheckAndUnlock_StartsNewSession (0.01s)
=== RUN   TestCheckAndUnlock_ClearsCacheOnUnlock
time=2025-12-19T09:32:59.381Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1 contributions=500 rollover=0
--- PASS: TestCheckAndUnlock_ClearsCacheOnUnlock (0.00s)
=== RUN   TestCheckAndUnlock_NoProgress
--- PASS: TestCheckAndUnlock_NoProgress (0.00s)
=== RUN   TestCheckAndUnlock_TargetNotSet
--- PASS: TestCheckAndUnlock_TargetNotSet (0.00s)
=== RUN   TestCheckAndUnlock_BelowThreshold
--- PASS: TestCheckAndUnlock_BelowThreshold (0.00s)
=== RUN   TestAddContribution_Success
--- PASS: TestAddContribution_Success (0.00s)
=== RUN   TestAddContribution_CreatesProgress
--- PASS: TestAddContribution_CreatesProgress (0.00s)
=== RUN   TestAddContribution_InstantUnlock
time=2025-12-19T09:32:59.381Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.381Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=u1 nodeKey=item_money sessionID=1
time=2025-12-19T09:32:59.381Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=2 votes=1 voterCount=1
time=2025-12-19T09:32:59.381Z level=INFO msg="Unlock threshold met, triggering unlock" service=brandish-bot version=dev environment=dev accumulated=500 required=500
time=2025-12-19T09:32:59.381Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.381Z level=INFO msg="Node unlocked" service=brandish-bot version=dev environment=dev nodeKey=item_money level=1 contributions=500 rollover=0
time=2025-12-19T09:32:59.381Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=2 options=2
--- PASS: TestAddContribution_InstantUnlock (0.10s)
=== RUN   TestGetUnlockProgress_Active
--- PASS: TestGetUnlockProgress_Active (0.00s)
=== RUN   TestGetUnlockProgress_None
--- PASS: TestGetUnlockProgress_None (0.00s)
=== RUN   TestStartVotingSession_Success
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
--- PASS: TestStartVotingSession_Success (0.00s)
=== RUN   TestStartVotingSession_FewerThan4Available
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=4
--- PASS: TestStartVotingSession_FewerThan4Available (0.00s)
=== RUN   TestStartVotingSession_NoAvailableNodes
--- PASS: TestStartVotingSession_NoAvailableNodes (0.00s)
=== RUN   TestStartVotingSession_MultiLevelNode
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=4
--- PASS: TestStartVotingSession_MultiLevelNode (0.00s)
=== RUN   TestVoteForUnlock_Success
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.482Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_lootbox0 sessionID=1
--- PASS: TestVoteForUnlock_Success (0.00s)
=== RUN   TestVoteForUnlock_NoActiveSession
--- PASS: TestVoteForUnlock_NoActiveSession (0.00s)
=== RUN   TestVoteForUnlock_SessionNotVoting
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
--- PASS: TestVoteForUnlock_SessionNotVoting (0.00s)
=== RUN   TestVoteForUnlock_NodeNotInOptions
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
--- PASS: TestVoteForUnlock_NodeNotInOptions (0.00s)
=== RUN   TestVoteForUnlock_UserAlreadyVoted
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.482Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_money sessionID=1
--- PASS: TestVoteForUnlock_UserAlreadyVoted (0.00s)
=== RUN   TestEndVoting_Success
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.482Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.482Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user2 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.482Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=4 votes=2 voterCount=2
--- PASS: TestEndVoting_Success (0.00s)
=== RUN   TestEndVoting_TieBreaker
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.482Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_money sessionID=1
time=2025-12-19T09:32:59.482Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user2 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.482Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=2 votes=1 voterCount=2
--- PASS: TestEndVoting_TieBreaker (0.00s)
=== RUN   TestEndVoting_ZeroVotes
time=2025-12-19T09:32:59.482Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.482Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=2 votes=0 voterCount=0
--- PASS: TestEndVoting_ZeroVotes (0.00s)
=== RUN   TestEndVoting_AwardsContributions
time=2025-12-19T09:32:59.483Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.483Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user1 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.483Z level=INFO msg="Vote recorded" service=brandish-bot version=dev environment=dev userID=user2 nodeKey=item_lootbox0 sessionID=1
time=2025-12-19T09:32:59.483Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=4 votes=2 voterCount=2
--- PASS: TestEndVoting_AwardsContributions (0.00s)
=== RUN   TestEndVoting_NoActiveSession
--- PASS: TestEndVoting_NoActiveSession (0.00s)
=== RUN   TestEndVoting_AlreadyEnded
time=2025-12-19T09:32:59.483Z level=INFO msg="Started new voting session" service=brandish-bot version=dev environment=dev sessionID=1 options=2
time=2025-12-19T09:32:59.483Z level=INFO msg="Voting ended" service=brandish-bot version=dev environment=dev sessionID=1 winningNode=2 votes=0 voterCount=0
--- PASS: TestEndVoting_AlreadyEnded (0.00s)
=== RUN   TestFindWinningOption_WithVotes
=== RUN   TestFindWinningOption_WithVotes/clear_winner_by_vote_count
=== RUN   TestFindWinningOption_WithVotes/tie_broken_by_LastHighestVoteAt
=== RUN   TestFindWinningOption_WithVotes/all_zero_votes_-_random_selection
=== RUN   TestFindWinningOption_WithVotes/single_option
--- PASS: TestFindWinningOption_WithVotes (0.00s)
    --- PASS: TestFindWinningOption_WithVotes/clear_winner_by_vote_count (0.00s)
    --- PASS: TestFindWinningOption_WithVotes/tie_broken_by_LastHighestVoteAt (0.00s)
    --- PASS: TestFindWinningOption_WithVotes/all_zero_votes_-_random_selection (0.00s)
    --- PASS: TestFindWinningOption_WithVotes/single_option (0.00s)
=== RUN   TestFindWinningOption_EmptyOptions
--- PASS: TestFindWinningOption_EmptyOptions (0.00s)
=== RUN   TestFindWinningOption_ZeroVotesRandomness
--- PASS: TestFindWinningOption_ZeroVotesRandomness (0.00s)
=== RUN   TestSelectRandomNodes
=== RUN   TestSelectRandomNodes/select_4_from_5
=== RUN   TestSelectRandomNodes/select_more_than_available
=== RUN   TestSelectRandomNodes/select_exact_count
--- PASS: TestSelectRandomNodes (0.00s)
    --- PASS: TestSelectRandomNodes/select_4_from_5 (0.00s)
    --- PASS: TestSelectRandomNodes/select_more_than_available (0.00s)
    --- PASS: TestSelectRandomNodes/select_exact_count (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/progression	0.282s
?   	github.com/osse101/BrandishBot_Go/internal/repository	[no test files]
=== RUN   TestScheduler
--- PASS: TestScheduler (0.02s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/scheduler	0.029s
=== RUN   TestAuthMiddleware
=== RUN   TestAuthMiddleware/Valid_API_Key
=== RUN   TestAuthMiddleware/Invalid_API_Key
time=2025-12-19T09:33:00.198Z level=WARN msg="Authentication failed" service=brandish-bot version=dev environment=dev remote_addr=192.0.2.1:1234 path=/api/test has_key=true ip=192.0.2.1
=== RUN   TestAuthMiddleware/Missing_API_Key
time=2025-12-19T09:33:00.199Z level=WARN msg="Authentication failed" service=brandish-bot version=dev environment=dev remote_addr=192.0.2.1:1234 path=/api/test has_key=false ip=192.0.2.1
=== RUN   TestAuthMiddleware/Public_Path_-_Healthz
=== RUN   TestAuthMiddleware/Public_Path_-_Metrics
--- PASS: TestAuthMiddleware (0.00s)
    --- PASS: TestAuthMiddleware/Valid_API_Key (0.00s)
    --- PASS: TestAuthMiddleware/Invalid_API_Key (0.00s)
    --- PASS: TestAuthMiddleware/Missing_API_Key (0.00s)
    --- PASS: TestAuthMiddleware/Public_Path_-_Healthz (0.00s)
    --- PASS: TestAuthMiddleware/Public_Path_-_Metrics (0.00s)
=== RUN   TestAuthMiddleware_RecordsFailures
time=2025-12-19T09:33:00.199Z level=WARN msg="Authentication failed" service=brandish-bot version=dev environment=dev remote_addr=192.168.1.5:12345 path=/api/test has_key=false ip=192.168.1.5
time=2025-12-19T09:33:00.199Z level=WARN msg="Authentication failed" service=brandish-bot version=dev environment=dev remote_addr=192.168.1.5:12345 path=/api/test has_key=false ip=192.168.1.5
--- PASS: TestAuthMiddleware_RecordsFailures (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/server	0.029s
=== RUN   TestConcurrency_RecordUserEvent
--- PASS: TestConcurrency_RecordUserEvent (0.00s)
=== RUN   TestRecordUserEvent
--- PASS: TestRecordUserEvent (0.00s)
=== RUN   TestRecordUserEvent_DailyStreak
--- PASS: TestRecordUserEvent_DailyStreak (0.00s)
=== RUN   TestRecordUserEventEmptyUserID
--- PASS: TestRecordUserEventEmptyUserID (0.00s)
=== RUN   TestGetUserStats
--- PASS: TestGetUserStats (0.00s)
=== RUN   TestGetSystemStats
--- PASS: TestGetSystemStats (0.00s)
=== RUN   TestGetLeaderboard
--- PASS: TestGetLeaderboard (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/stats	0.006s
=== RUN   TestGoroutineChecker_NoLeak
--- PASS: TestGoroutineChecker_NoLeak (0.11s)
=== RUN   TestGoroutineChecker_WithTolerance
--- PASS: TestGoroutineChecker_WithTolerance (0.14s)
=== RUN   TestMemoryChecker_SmallAllocation
--- PASS: TestMemoryChecker_SmallAllocation (0.07s)
=== RUN   TestCheckNoGoroutineLeak_Success
--- PASS: TestCheckNoGoroutineLeak_Success (0.12s)
=== RUN   TestCheckNoMemoryLeak_Success
--- PASS: TestCheckNoMemoryLeak_Success (0.07s)
=== RUN   TestWaitForGoroutines_Success
--- PASS: TestWaitForGoroutines_Success (0.01s)
=== RUN   TestGoroutineChecker_Integration
=== RUN   TestGoroutineChecker_Integration/goroutines_properly_cleaned_up
--- PASS: TestGoroutineChecker_Integration (0.12s)
    --- PASS: TestGoroutineChecker_Integration/goroutines_properly_cleaned_up (0.12s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/testing/leaktest	0.643s
=== RUN   TestConcurrency_AddItem
    concurrency_test.go:54: Starting 100 concurrent AddItem operations...
--- PASS: TestConcurrency_AddItem (0.01s)
=== RUN   TestProcessLootbox
=== RUN   TestProcessLootbox/Lootbox0_drops_money
=== RUN   TestProcessLootbox/Lootbox0_insufficient_quantity
--- PASS: TestProcessLootbox (0.00s)
    --- PASS: TestProcessLootbox/Lootbox0_drops_money (0.00s)
    --- PASS: TestProcessLootbox/Lootbox0_insufficient_quantity (0.00s)
=== RUN   TestLoadLootTables
--- PASS: TestLoadLootTables (0.00s)
=== RUN   TestHandleSearch_Success
time=2025-12-19T09:33:00.890Z level=INFO msg="HandleSearch called" platform=twitch platformID=testuser123 username=testuser
--- FAIL: TestHandleSearch_Success (0.00s)
panic: runtime error: invalid memory address or nil pointer dereference
	panic: runtime error: invalid memory address or nil pointer dereference [recovered]
	panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0x5ba86c]

goroutine 118 [running]:
testing.tRunner.func1.2({0x66d3c0, 0x8db5a0})
	/usr/local/go/src/testing/testing.go:1734 +0x21c
testing.tRunner.func1()
	/usr/local/go/src/testing/testing.go:1737 +0x35e
panic({0x66d3c0?, 0x8db5a0?})
	/usr/local/go/src/runtime/panic.go:792 +0x132
github.com/osse101/BrandishBot_Go/internal/repository.SafeRollback({0x71bda8, 0x90af00}, {0x0?, 0x0?})
	/app/internal/repository/utils.go:12 +0x2c
panic({0x66d3c0?, 0x8db5a0?})
	/usr/local/go/src/runtime/panic.go:792 +0x132
github.com/osse101/BrandishBot_Go/internal/user.(*service).HandleSearch(0xc00018e180, {0x71bda8, 0x90af00}, {0x6b6173, 0x6}, {0x6b7a8d, 0xb}, {0x6b69fc, 0x8})
	/app/internal/user/service.go:671 +0xd3d
github.com/osse101/BrandishBot_Go/internal/user.TestHandleSearch_Success(0xc000180700)
	/app/internal/user/search_test.go:201 +0x135
testing.tRunner(0xc000180700, 0x6cee60)
	/usr/local/go/src/testing/testing.go:1792 +0xf4
created by testing.(*T).Run in goroutine 1
	/usr/local/go/src/testing/testing.go:1851 +0x413
FAIL	github.com/osse101/BrandishBot_Go/internal/user	0.022s
=== RUN   TestFindSlot
=== RUN   TestFindSlot/finds_existing_item_in_inventory
=== RUN   TestFindSlot/returns_-1_and_0_for_non-existent_item
=== RUN   TestFindSlot/finds_first_occurrence_when_item_appears_multiple_times
=== RUN   TestFindSlot/handles_empty_inventory
=== RUN   TestFindSlot/finds_item_at_last_position
=== RUN   TestFindSlot/correctly_handles_zero_quantity_items
--- PASS: TestFindSlot (0.00s)
    --- PASS: TestFindSlot/finds_existing_item_in_inventory (0.00s)
    --- PASS: TestFindSlot/returns_-1_and_0_for_non-existent_item (0.00s)
    --- PASS: TestFindSlot/finds_first_occurrence_when_item_appears_multiple_times (0.00s)
    --- PASS: TestFindSlot/handles_empty_inventory (0.00s)
    --- PASS: TestFindSlot/finds_item_at_last_position (0.00s)
    --- PASS: TestFindSlot/correctly_handles_zero_quantity_items (0.00s)
=== RUN   TestFindSlot_RealWorldScenarios
=== RUN   TestFindSlot_RealWorldScenarios/money_lookup_in_typical_inventory
=== RUN   TestFindSlot_RealWorldScenarios/checking_for_crafting_material_before_craft
=== RUN   TestFindSlot_RealWorldScenarios/checking_for_item_that_player_doesn't_own
--- PASS: TestFindSlot_RealWorldScenarios (0.00s)
    --- PASS: TestFindSlot_RealWorldScenarios/money_lookup_in_typical_inventory (0.00s)
    --- PASS: TestFindSlot_RealWorldScenarios/checking_for_crafting_material_before_craft (0.00s)
    --- PASS: TestFindSlot_RealWorldScenarios/checking_for_item_that_player_doesn't_own (0.00s)
=== RUN   TestLoadJSON
=== RUN   TestLoadJSON/loads_valid_JSON_file_successfully
=== RUN   TestLoadJSON/returns_error_for_non-existent_file
=== RUN   TestLoadJSON/returns_error_for_invalid_JSON
=== RUN   TestLoadJSON/handles_empty_JSON_object
--- PASS: TestLoadJSON (0.00s)
    --- PASS: TestLoadJSON/loads_valid_JSON_file_successfully (0.00s)
    --- PASS: TestLoadJSON/returns_error_for_non-existent_file (0.00s)
    --- PASS: TestLoadJSON/returns_error_for_invalid_JSON (0.00s)
    --- PASS: TestLoadJSON/handles_empty_JSON_object (0.00s)
=== RUN   TestSaveJSON
=== RUN   TestSaveJSON/saves_data_to_JSON_file_with_proper_formatting
=== RUN   TestSaveJSON/returns_error_for_invalid_path
=== RUN   TestSaveJSON/handles_non-serializable_data_gracefully
--- PASS: TestSaveJSON (0.00s)
    --- PASS: TestSaveJSON/saves_data_to_JSON_file_with_proper_formatting (0.00s)
    --- PASS: TestSaveJSON/returns_error_for_invalid_path (0.00s)
    --- PASS: TestSaveJSON/handles_non-serializable_data_gracefully (0.00s)
=== RUN   TestLoadJSON_SaveJSON_RoundTrip
--- PASS: TestLoadJSON_SaveJSON_RoundTrip (0.00s)
=== RUN   TestDiminishingReturns
=== RUN   TestDiminishingReturns/zero_value_returns_zero
=== RUN   TestDiminishingReturns/negative_value_returns_zero
=== RUN   TestDiminishingReturns/value_equals_scale_gives_0.5
=== RUN   TestDiminishingReturns/very_small_value_approaches_zero
=== RUN   TestDiminishingReturns/very_large_value_approaches_1
=== RUN   TestDiminishingReturns/double_the_scale_halves_the_effectiveness
--- PASS: TestDiminishingReturns (0.00s)
    --- PASS: TestDiminishingReturns/zero_value_returns_zero (0.00s)
    --- PASS: TestDiminishingReturns/negative_value_returns_zero (0.00s)
    --- PASS: TestDiminishingReturns/value_equals_scale_gives_0.5 (0.00s)
    --- PASS: TestDiminishingReturns/very_small_value_approaches_zero (0.00s)
    --- PASS: TestDiminishingReturns/very_large_value_approaches_1 (0.00s)
    --- PASS: TestDiminishingReturns/double_the_scale_halves_the_effectiveness (0.00s)
=== RUN   TestDiminishingReturns_Properties
=== RUN   TestDiminishingReturns_Properties/monotonically_increasing
=== RUN   TestDiminishingReturns_Properties/bounded_between_0_and_1
=== RUN   TestDiminishingReturns_Properties/asymptotic_behavior_toward_1
--- PASS: TestDiminishingReturns_Properties (0.00s)
    --- PASS: TestDiminishingReturns_Properties/monotonically_increasing (0.00s)
    --- PASS: TestDiminishingReturns_Properties/bounded_between_0_and_1 (0.00s)
    --- PASS: TestDiminishingReturns_Properties/asymptotic_behavior_toward_1 (0.00s)
=== RUN   TestRandomInt
=== RUN   TestRandomInt/returns_value_within_range
=== RUN   TestRandomInt/handles_min_equals_max
=== RUN   TestRandomInt/handles_inverted_range_gracefully
=== RUN   TestRandomInt/handles_negative_ranges
=== RUN   TestRandomInt/produces_different_values_over_multiple_calls
--- PASS: TestRandomInt (0.00s)
    --- PASS: TestRandomInt/returns_value_within_range (0.00s)
    --- PASS: TestRandomInt/handles_min_equals_max (0.00s)
    --- PASS: TestRandomInt/handles_inverted_range_gracefully (0.00s)
    --- PASS: TestRandomInt/handles_negative_ranges (0.00s)
    --- PASS: TestRandomInt/produces_different_values_over_multiple_calls (0.00s)
=== RUN   TestRandomFloat
=== RUN   TestRandomFloat/returns_value_between_0_and_1
=== RUN   TestRandomFloat/produces_varied_results
--- PASS: TestRandomFloat (0.00s)
    --- PASS: TestRandomFloat/returns_value_between_0_and_1 (0.00s)
    --- PASS: TestRandomFloat/produces_varied_results (0.00s)
=== RUN   TestSecureRandomInt
=== RUN   TestSecureRandomInt/returns_value_within_range
=== RUN   TestSecureRandomInt/panics_on_invalid_input
--- PASS: TestSecureRandomInt (0.00s)
    --- PASS: TestSecureRandomInt/returns_value_within_range (0.00s)
    --- PASS: TestSecureRandomInt/panics_on_invalid_input (0.00s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/utils	0.012s
=== RUN   TestPool
--- PASS: TestPool (0.10s)
PASS
ok  	github.com/osse101/BrandishBot_Go/internal/worker	0.106s
FAIL
